#!/bin/bash

# Apply the updated blue deployment
echo "Applying updated blue deployment (version 2.0)..."
kubectl apply -f messaging_app/blue_deployment.yaml

# Monitor the rollout status
echo "Monitoring rollout..."
kubectl rollout status deployment/messaging-app-blue

# Test for downtime by sending continuous requests during the rollout
echo "Testing for downtime (Ctrl+C to stop)..."
for i in {1..20}
do
  curl -s -o /dev/null -w "%{http_code}\n" http://localhost:8000/
  sleep 1
done

# Show current pods
echo "Current running pods:"
kubectl get pods -o wide
